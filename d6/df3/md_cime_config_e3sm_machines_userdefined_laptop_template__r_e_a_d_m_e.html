<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CAM6: Building CESM on an UNSUPPORTED local machine</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CAM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Building CESM on an UNSUPPORTED local machine </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>These directions are for a Mac OS X 10.9 or 10.10 laptop using homebrew or macports to install the required software. The procedure is similar for a linux workstation or cluster, you will just use different package management tools to install the third party libraries.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Setup</h1>
<ul>
<li>install xcode, including the command line tools. Failure to install the command line tools is the most likely cause if you get an error about the compilers not being able to create executables.</li>
<li>install third party libraries from homebrew or macports.<ul>
<li><p class="startli">home brew</p>
<p class="startli">Install science tap : <a href="https://github.com/Homebrew/homebrew-science">https://github.com/Homebrew/homebrew-science</a> </p><pre class="fragment">brew install gcc --without-multilib cmake mpich hdf5 --enable-fortran netcdf --enable-fortran
</pre></li>
<li>macports <pre class="fragment">sudo port install mpich +gcc48 hdf5-18 +mpich netcdf-fortran +gcc48 +mpich cmake
</pre> Note: If you see an error while running create_newcase that indicates perl can't find XML::LibXML, you may need to install p5-xml-libxml as well.</li>
</ul>
</li>
<li>Some of the shell scripts used by cesm hard code "gmake" instead of using the GMAKE variable from env_build.xml. To work around this, you should install gnu make, or simply create a link from make to gmake in you path. <pre class="fragment">mkdir -p ${HOME}/local/bin
ln -s `whereis make` ${HOME}/local/bin/gmake
cat &gt;&gt; ${HOME}/.bashrc &lt;&lt;EOF
export PATH=${PATH}:${HOME}/local/bin
EOF
</pre></li>
<li>Create a directory for the local copy of the cesm input data: <pre class="fragment">mkdir -p ~/projects/cesm-inputdata
</pre> Plan on downloading ~30 GB of data before the first build.</li>
<li><p class="startli">build cprnc :</p>
<p class="startli">homebrew : </p><pre class="fragment">cd ${CESMROOT}/tools/cprnc
mkdir build
cd build
cmake \
    -DCMAKE_Fortran_COMPILER=/usr/local/bin/mpif90 \
    -DHDF5_DIR=/usr/local \
    -DNetcdf_INCLUDE_DIR=/usr/local/include ..
make
</pre><p class="startli">macports : </p><pre class="fragment">cd ${CESMROOT}/tools/cprnc
mkdir build
cd build
cmake \
    -DCMAKE_Fortran_COMPILER=/opt/local/bin/mpif90-mpich-gcc48 \
    -DHDF5_DIR=/opt/local \
    -DNetcdf_INCLUDE_DIR=/opt/local/include ..
make
</pre></li>
<li>copy the template directory: <pre class="fragment">cp ${CESMROOT}/machines/userdefined_laptop_template ${HOME}/.cesm
</pre> NOTE: it is highly reccommend that you place ~/.cesm under version control with your favorite tool.</li>
<li><p class="startli">make sure ~/.cesm has mkbatch.YOUR_MACHINE_NAME and your machine is listed in config_machines.xml, config_compilers.xml, config_pes.xml.</p><ul>
<li>config_machines.xml must have a section for this machine and all the paths are correct. Especially note that the example puts input data, scratch, and archive into ${HOME}/projects</li>
<li>config_compilers.xml - set the correct path's for your system.</li>
<li>mkbatch.NAME</li>
</ul>
<p class="startli">NOTE: the path to mpiexec is hard coded is this file. You MUST update the example file with the correct path!</p><ul>
<li>config_pes.xml</li>
</ul>
<p class="startli">NOTE: that the selected pe layout is order dependent, and the standard config_pes.xml is read first, then over ridden by this file.</p>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
First Use</h1>
<ul>
<li>Use should be the same on a laptop or workstation as a supercomputer.</li>
<li>create a case: <pre class="fragment">cd ~/projects/my-cesm-sandbox/scripts
./create_newcase \
    -mach durango \
    -compiler gnu \
    -case ../junk-1x1_brazil \
    -compset ICLM45CN \
    -res 1x1_brazil
</pre></li>
<li>run <code>cesm_setup</code>, <code>$CASE_NAME.build</code>, <code>$CASE_NAME.run</code> as normal.</li>
<li>Test a global simulation, use: -res f45_f45</li>
</ul>
<p>Running a test suite or individual test should work like on any supported platform: </p><pre class="fragment"> ./create_test \
     -mach durango -compiler gnu \
     -xml_mach durango -xml_compiler gnu \
     -testroot ../junk-root \
     -xml_category aux_pop_obgc_se \
     -nobatch on
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
